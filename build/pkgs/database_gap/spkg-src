#!/usr/bin/env bash

if [ $# -ne 0 ]; then
    UPSTREAM_SOURCE_TARBALL=$1
    echo "Using $UPSTREAM_SOURCE_TARBALL instead of downloading tarball"
fi

SPKG_ROOT=`pwd`

set -e
shopt -s extglob

# Remove old sources and download new
rm -rf src
if [ -z "$UPSTREAM_SOURCE_TARBALL" ]; then
    tar xjf <( curl ftp://ftp.gap-system.org/pub/gap/gap46/tar.bz2/gap4r6p5_2013_07_20-20_02.tar.bz2 )
else
    tar xjf "$UPSTREAM_SOURCE_TARBALL"
fi
GAP=`pwd`/gap4r6

# Make everything writable
chmod -R u+w "$GAP"


mkdir src
mkdir src/pkg
for pkg in small pkg/tomlib prim trans
do
    cp -rap "$GAP/$pkg" "src/$pkg"
done
rm -rf "$GAP"


# tar cjf database_gap-4.6.5.tar.bz2 src/  && rm -rf src/
