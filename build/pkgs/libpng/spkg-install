#!/bin/sh

cd src

# Need to detect zlib
CFLAGS="$CFLAGS -I\"$SAGE_LOCAL/include\""
export CFLAGS

if [ `uname` = "Darwin" ]; then
    # Using libpng on Darwin is a disaster, since it conflicts
    # with the system-wide libraries big time.  It makes
    # building on 10.5 impossible.  So we don't build it.
    # (It is tempting to actually delete it here, but that
    # would probably break existing installs?)
    rm -f "$SAGE_LOCAL"/lib/libPng.dylib
    rm -rf "$SAGE_LOCAL"/include/png*
    rm -rf "$SAGE_LOCAL"/bin/libpng*
    exit 0
else
    ./configure --prefix="$SAGE_LOCAL" --enable-shared=yes
fi

if [ $? -ne 0 ]; then
    echo "Error configuring libpng"
    exit 1
fi

make

if [ $? -ne 0 ]; then
    echo "Error building libpng"
    exit 1
fi

make install

if [ $? -ne 0 ]; then
    echo "Error installing libpng"
    exit 1
fi
