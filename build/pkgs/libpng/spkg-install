#!/bin/sh

cd src

# Need to detect zlib
CFLAGS="$CFLAGS -I\"$SAGE_LOCAL/include\""
export CFLAGS

if [ `uname` = "Darwin" ]; then
    # The libpng dylibs seem to cause problems on OS X
    # Using the static libs only solves the problem.
    # This solution was taken from the IInstaller.
    ./configure --prefix="$SAGE_LOCAL" --enable-shared=yes
else
    ./configure --prefix="$SAGE_LOCAL" --enable-shared=yes
fi

if [ $? -ne 0 ]; then
    echo "Error configuring libpng"
    exit 1
fi

make

if [ $? -ne 0 ]; then
    echo "Error building libpng"
    exit 1
fi

make install

if [ $? -ne 0 ]; then
    echo "Error installing libpng"
    exit 1
fi
