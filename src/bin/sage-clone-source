#!/usr/bin/env bash

########################################################################
# Helper script for sdist/bdist
#
# Usage: sage-clone-source SRC DST
#
# Create empty directory DST (delete it if it existed) and copy all
# Sage source files from SRC to DST using git.
#
# Also generate auto-generated files like "configure" in DST.
########################################################################

set -e

if [ $# -ne 2 ]; then
    echo >&2 "Usage: $0 SRC DST"
    exit 2
fi

SRC="$1"
DST="$2"

rm -rf "$DST"
mkdir -p "$DST"

git clone "$SRC" "$DST"

cd "$DST"
git remote set-url origin "$SAGE_REPO_ANONYMOUS"

# Save space
git prune

# Generate auto-generated files (without using "missing")
make MISSING= configure

echo "Finished cloning Sage sources"
