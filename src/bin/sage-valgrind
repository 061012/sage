#!/usr/bin/env bash

if [ ! -d "$DOT_SAGE/valgrind" ]; then
    mkdir "$DOT_SAGE/valgrind"
fi

MEMCHECK_FLAGS="--leak-resolution=high --leak-check=full --num-callers=25 --suppressions=$SAGE_EXTCODE/valgrind/sage.supp"

if [ "$SAGE_MEMCHECK_FLAGS" ]; then
    echo "Overwriting memcheck flags with: $SAGE_MEMCHECK_FLAGS"
    MEMCHECK_FLAGS=$SAGE_MEMCHECK_FLAGS
else
    echo "Using default flags: $MEMCHECK_FLAGS"
fi

valgrind --tool=memcheck $MEMCHECK_FLAGS python "$SAGE_LOCAL/bin/sage-ipython" "$@" -
